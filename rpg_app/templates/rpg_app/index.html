{% comment %} {% extends 'base.html' %} {% endcomment %}

{% block content %}
<head>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@1.*/css/pico.min.css">
</head>
<body>
  <main class="container">
    <h1>Random Roll Table Generator</h1>
    <p> Roll table category: </p>
    <form id="myForm">
      {% csrf_token %}
      <input type="text" name="myInput">
      <button id="rollTableButton" type="submit">Submit</button>
    </form>

    <h1>Roll table:</h1>
    <article aria-busy="false" id="myResponse"></article>

    <footer> This is an early proof of concept website for this project. Please be conservative with the number of loot tables you generate. Loot tables are expensive </footer>
  </main>
</body>
<script>
var address = 'wss://' + window.location.host + '/my_consumer/'
console.log(address)
var socket = new WebSocket(address);


socket.onmessage = function(event) {
  var data = JSON.parse(event.data);

  if (data.response) {
    document.getElementById('myResponse').innerHTML = data.response;
  }

  document.getElementById('myResponse').setAttribute('aria-busy', data.loading);
  document.getElementById('rollTableButton').setAttribute('aria-busy', data.loading);

  
};

document.getElementById('myForm').addEventListener('submit', function(event) {
  event.preventDefault();
  var input = document.getElementsByName('myInput')[0].value;
  socket.send(JSON.stringify({
    'input': input
  }));
});
</script>
{% endblock %}
